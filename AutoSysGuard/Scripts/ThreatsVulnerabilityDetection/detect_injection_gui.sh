#!/bin/bash

# Default log file path
DEFAULT_LOG_FILE="/var/log/nginx/access.log" 

# Common injection patterns
PATTERNS=(
    "UNION SELECT"  # SQL Injection
    "SELECT .* FROM"  # SQL Injection
    "DROP TABLE"  # SQL Injection
    "' OR '1'='1"  # SQL Injection
    "--"  # SQL comment-based injection
    "<script>"  # XSS Attack
    "alert("  # XSS Attack
    "; rm -rf /"  # Command Injection
    "wget http"  # Command Injection
    "curl http"  # Command Injection
)

# Function to run the injection detection script in the background
start_detection() {
    local log_file=$1
    # Run the detection script in the background using nohup
    nohup AutoSysGuard/Scripts/ThreatsVulnerabilityDetection/detect_injection.sh "$log_file" > /dev/null 2>&1 &
    zenity --info --text="Detection started in the background for log file: $log_file"
}

# Ask the user to select the log file using Zenity's file selection dialog
LOG_FILE=$(zenity --file-selection --title="Select Log File" --filename="$DEFAULT_LOG_FILE")

# Check if the user selected a file
if [[ -z "$LOG_FILE" ]]; then
    zenity --error --text="No log file selected. Exiting."
    exit 1
fi

# Start the injection detection in the background
start_detection "$LOG_FILE"
