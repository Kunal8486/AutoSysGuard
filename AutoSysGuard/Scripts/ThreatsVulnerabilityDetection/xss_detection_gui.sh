#!/bin/bash

# Default Log File
DEFAULT_LOG_FILE="/var/log/nginx/access.log"

# Function to start detection in the background
start_detection() {
    local log_file=$1
    # Start the detection script in the background using nohup
    nohup bash ./AutoSysGuard/Scripts/ThreatsVulnerabilityDetection/xss_detection.sh "$log_file" > /dev/null 2>&1 &
    zenity --info --text="XSS Detection started for log file: $log_file"
}

# GUI to select log file using Zenity
LOG_FILE=$(zenity --file-selection --title="Select Log File" --filename="$DEFAULT_LOG_FILE")

# Check if a log file was selected
if [[ -z "$LOG_FILE" ]]; then
    zenity --error --text="No log file selected. Exiting."
    exit 1
fi

# GUI to confirm and start detection
zenity --question --text="Do you want to start XSS detection on $LOG_FILE?"
if [[ $? -eq 0 ]]; then
    start_detection "$LOG_FILE"
fi
